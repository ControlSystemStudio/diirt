<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <title>JSON serialization for vTypes</title>
    </head>

    <body>

        <div class="head">

            <h1>JSON serialization for vTypes</h1>

            <h2>Version 1</h2>
            <hr />

        </div>

        <div id="contents" class="contents">

            <div id="introduction">
                <h2>Introduction</h2>

                <p>This document describes the serialization to JSON of vTypes as provided
                    by this library. The purpose of the JSON serialization is to interoperate
                    with different domains, such as web services/sockets and python scripting.
                    </p>

                <p>Current support is included for the following types:</p>
                <ul>
                    <li>VNumber (VDouble, VFloat, VLong, VInt, VShort, VByte)</li> 
                    <li>VBoolean</li>
                    <li>VEnum</li>
                    <li>VString</li>
                    <li>VNumberArray (VDoubleArray, VFloatArray, VLongArray, VIntArray, VShortArray, VByteArray)</li> 
                    <li>VBooleanArray</li>
                    <li>VEnumArray</li>
                    <li>VStringArray</li>
                    <li>VTable</li>
                </ul>              
                <p>Note that JSON serialization in verbose and not efficient. Therefore
                it can be used for data of moderate size and slow update rate.
                Hopefully, in the future, BSON will reach a standardization point
                and availability, to handle more efficient encoding.</p>

                <p>The JSON serialization is broken down into the basic vTypes components:</p>
                <ul id="seds_types">
                    <li>Alarm</li>
                    <li>Display</li>
                    <li>Enum</li>
                    <li>Time</li>
                </ul>
                <p>The serialization of each element is common across vTypes.</p>
                <hr /> 
            </div>

            <div id = "definitions">
                <h2>JSON definitions</h2>
                <h3>Type</h3>
                <p>The purpose of the type field is to signal that a particular
                    JSON object is the serialization of a vType. It will also contain
                    all information needed to de-serialize or use the object,
                    including the version and actual type name.</p>

                <p>Type definition:</p>
                <pre>
    type :=
                String      name
                String      version
                </pre>

                <p>The type name can be one of supported types: </p>
                <pre>
    <u>Scalars</u>         <u>Arrays</u>                 <u>Complex</u>
    VDouble         VDoubleArray           VTable
    VFloat          VFloatArray
    VLong           VLongArray
    VInt            VIntArray
    VShort          VShortArray
    VByte           VByteArray
    VBoolean        VBooleanArray
    VEnum           VEnumArray
    VString         VStringArray
                </pre>
                <p>This document refers to version "1"</p>

                <p>An example of a JSON instance of Type:</p>
                <pre>
    {
        "name": "VDouble",
        "version": "1"
    }                   
                </pre>
                    <hr />


                <h3>Alarm</h3>                
                <div>
                    <p>An Alarm:</p>
                    <pre>
    <span class="seds">Alarm</span> :=
                String      severity
                String      status
                    </pre>

                    <p>Descriptions:</p>
                    <pre>
    Alarm:
        Alarm information. Represents the severity and name of the highest alarm
        associated with the channel.
                    </pre>
                    <pre>
    severity:
        Severity that MUST be a value in the enumeration:
        [NONE, MINOR, MAJOR, INVALID, UNDEFINED].

    status:
        Status is a short string that represents the alarm.

                    </pre>


                    <p>Example of a JSON fields for an Alarm:</p>
                    <pre>                
    {
        "severity": "NONE",
        "status": "NONE",
    }

    {
        "severity": "MINOR",
        "status": "LOW",
    }
                    </pre>
                    <hr />
                </div>


                <h3>Display</h3>
                <div>
                    <p>A Display:</p>
                    <pre>
    <span class="seds">Display</span> :=
                Number      lowAlarm
                Number      highAlarm
                Number      lowDisplay
                Number      highDisplay
                Number      lowWarning
                Number      highWarning
                String      units
                    </pre>

                    <p>Descriptions:</p>
                    <pre>
    Display:
        Limit and unit information needed for display.
        The numeric limits are given in double precision no matter which numeric
        type. The unit is a simple String, which can be empty if no unit 
        information is provided.
                    </pre>
                    <pre>
    lowAlarm:
        Lowest value of the alarm range.

    highAlarm:
        Highest value of the alarm range.

    lowDisplay:
        Lowest value of the display range.

    highDisplay:
        Highest value of the display range.

    lowWarning:
        Lowest value of the warning range.

    highWarning:
        Highest value of the warning range.

    units:
        Text representation of the units used for values.
                    </pre>                    


                    <p>An example of a JSON instance of a Display:</p>
                    <pre>                
    {
        "lowAlarm": -80,
        "highAlarm": 80,
        "lowDisplay": -100,
        "highDisplay": 100,
        "lowWarning": 75,
        "highWarning": 75,
        "units": "m"
    }
                    </pre>            
                    <hr />
                </div>

                <h3>Enum</h3>
                <div>
                    <p>An Enum:</p>
                    <pre>
    <span class="seds">Enum</span> :=
                String[]    labels
                    </pre>

                    <p>Descriptions:</p>
                    <pre>
    Enum:
        The metadata necessary to encode an enumeration.
                    </pre>
                    <pre>
    labels:
        All the possible labels.
        MUST contain at least one element. 
        MUST contain unique elements.
                    </pre>                       


                    <p>An example of a JSON instance of an Enum</p>
                    <pre>                
    {
        "labels": [
            "ON", 
            "OFF", 
            "DISABLED"
        ]
    }
                    </pre>                 
                    <hr />
                </div>

                <!-- Time -->
                <h3>Time</h3>                
                <div>
                    <p>A Time:</p>
                    <pre>
    <span class="seds">Time</span> :=
                Integer     unixSec
                Integer     nanoSec
                Integer     userTag
                    </pre>

                    <p>Descriptions:</p>                    
                    <pre>
    Time:
        Time information.
                    </pre>
                    <pre>
    unixSec:
        Unix seconds portion of the timestamp. 64-bit signed.
        
    nanoSec:
        Nano seconds portion of the timestamp. 32-bit signed with a valid
        range of 0-999,999,999.

    userTag:
        A user defined tag, that can be used to store extra time information, 
        such as beam shot.
                    </pre>                      

                    <p>An example of a JSON instance of a Time:</p>
                    <pre>                
    {
        "unixSec": 1354719441,
        "nanoSec": 521786982,
        "userTag": 1
    }
                    </pre>    
                    <hr />
                </div>

                <h3>VNumber (VDouble, VFloat, VLong, VInt, VShort, VByte)</h3>                
                <div>
                    <p>A scalar numeric value:</p>
                    <pre>
    <span class="seds">VNumber</span> :=
                Type        type
                Number      value
                Alarm       alarm
                Time        time
                Display     display
                    </pre>

                    <p>The type/name can be one of VDouble/VFloat/VLong/VInt/VShort/VByte. The value is always a JSON number,
                        but the type/name will define the range allowed to such value.</p>

                    <p>Descriptions:</p>                    
                    <pre>
    VNumber:
        Basic type definition for all scalar numeric types, containing a value and 
        metadata. One must always look at the alarm severity to be able to 
        correctly interpret the value.
                    </pre>
                    <pre>
    value:
        The numeric value.

    alarm:
        Alarm linked with the value.

    time:
        Time linked with the value.

    display:
        Display linked with the value.
                    </pre>                      

                    <p>An example of a JSON instance of a VDouble:</p>
                    <pre>                
    {
        "type" : {
            "name": "VDouble",
            "version": "1"
        }
        "value": 3.1415,
        "alarm": {
            "severity": "NONE",
            "status": "NONE",
        },
        "time": {
            "unixSec": 1354719441,
            "nanoSec": 521786982,
            "userTag": 0
        }
        "display": {
            "lowAlarm": -80,
            "highAlarm": 80,
            "lowDisplay": -100,
            "highDisplay": 100,
            "lowWarning": 75,
            "highWarning": 75,
            "units": "rad"
        },
    }
                    </pre>                
                    <hr />
                </div>

                <h3>VBoolean</h3>                
                <div>
                    <p>A scalar boolean value:</p>
                    <pre>
    <span class="seds">VBoolean</span> :=
                Type        type
                Boolean     value
                Alarm       alarm
                Time        time
                    </pre>

                    <p>The type/name MUST be VBoolean. The value MUST the JSON constant TRUE or FALSE.</p>

                    <p>Descriptions:</p>                    
                    <pre>
    VBoolean:
        Basic type definition for scalar boolean, containing a value and 
        metadata. One must always look at the alarm severity to be able to 
        correctly interpret the value.
                    </pre>
                    <pre>
    value:
        The boolean value.

    alarm:
        Alarm linked with the value.

    time:
        Time linked with the value.

    display:
        Display linked with the value.
                    </pre>                      

                    <p>An example of a JSON instance of a VBoolean:</p>
                    <pre>                
    {
        "type" : {
            "name": "VBoolean",
            "version": "1"
        }
        "value": true,
        "alarm": {
            "severity": "NONE",
            "status": "NONE",
        },
        "time": {
            "unixSec": 1354719441,
            "nanoSec": 521786982,
            "userTag": 0
        }
    }
                    </pre>                
                    <hr />
                </div>
                
                <h3>VEnum</h3>                
                <div>
                    <p>A scalar enumeration value:</p>
                    <pre>
    <span class="seds">VEnum</span> :=
                Type        type
                Integer     value
                Alarm       alarm
                Time        time
                Enum        enum
                    </pre>

                    <p>The type/name MUST be VEnum. The value MUST be an integer in the range given by enum/labels.</p>

                    <p>Descriptions:</p>                    
                    <pre>
    VEnum:
        Basic type definition for scalar enum, containing a value and 
        metadata. One must always look at the alarm severity to be able to 
        correctly interpret the value.
                    </pre>
                    <pre>
    value:
        The index of the value in the enum/labels array.

    alarm:
        Alarm linked with the value.

    time:
        Time linked with the value.

    enum:
        Enum linked with the value.
                    </pre>                      

                    <p>An example of a JSON instance of a VEnum:</p>
                    <pre>                
    {
        "type" : {
            "name": "VEnum",
            "version": "1"
        }
        "value": 1,
        "alarm": {
            "severity": "NONE",
            "status": "NONE",
        },
        "time": {
            "unixSec": 1354719441,
            "nanoSec": 521786982,
            "userTag": 0
        }
        "enum": {
            "labels": [
                "ON", 
                "OFF", 
                "DISABLED"
            ]
        }
    }
                    </pre>                
                    <hr />
                </div>
                
                <h3>VString</h3>                
                <div>
                    <p>A scalar stringvalue:</p>
                    <pre>
    <span class="seds">VEnum</span> :=
                Type        type
                String      value
                Alarm       alarm
                Time        time
                    </pre>

                    <p>The type/name MUST be VString. The value MUST be a JSON string.</p>

                    <p>Descriptions:</p>                    
                    <pre>
    VString:
        Basic type definition for scalar string, containing a value and 
        metadata. One must always look at the alarm severity to be able to 
        correctly interpret the value.
                    </pre>
                    <pre>
    value:
        The string value.

    alarm:
        Alarm linked with the value.

    time:
        Time linked with the value.

                    </pre>                      

                    <p>An example of a JSON instance of a VString:</p>
                    <pre>                
    {
        "type" : {
            "name": "VString",
            "version": "1"
        }
        "value": "Hello",
        "alarm": {
            "severity": "NONE",
            "status": "NONE",
        },
        "time": {
            "unixSec": 1354719441,
            "nanoSec": 521786982,
            "userTag": 0
        }
    }
                    </pre>                
                    <hr />
                </div>

                <!-- ScalarArray -->
                <h3>ScalarArray</h3>                
                <div id="seds_scalar_array">
                    <p>A ScalarArray of <span class="seds">Type T</span>:</p>
                    <pre>
    <span class="seds">ScalarArray_T</span> :=
                T[]         value
                Alarm       alarm     :optional
                Control     control   :optional
                Display     display   :optional
                Time        time      :optional
                    </pre>

                    <p>Note that the <span class="seds">Type T</span> must be of the following <a href="#seds_field_types">types</a> defined by SEDS:</p>
                    <pre>
    <span class="seds">T</span> :=
            Boolean
         |  SedsEnum
         |  Integer
         |  Number
         |  String
         |  Null
                    </pre>

                    <p>Descriptions:</p>                    
                    <pre>
    ScalarArray:
        Basic type definition for all scalar array types, containing a value
        (array) and metadata. One must always look at the alarm severity to be 
        able to correctly interpret the value.

        Note that the value of scalar array is a homogeneous array of a given
        primitive type. Specifically, a scalar array is NOT a SedsScalar[].
        The exception is that NULL values are allowed as elements.
                    </pre>
                    <pre>
    valueArray:
        The primary data array associated with the scalar.

    alarm:
        Alarm metadata linked with the value.

    control:
        Control metadata linked with the value.

    display:
        Display metadata linked with the value.

    time:
        Time metadata linked with the value.
                    </pre>                       

                    <!-- Schema -->
                    <p>The JSON Schema of a ScalarArray is as follows:
                        <a href="schema/prototype/SedsScalarArray.json">ScalarArray Schema</a></p>

                    <p>An example of a JSON instance of a ScalarArray:</p>
                    <pre>                
    {
        "value": [1, 2, 3, 4],
        "alarm": {
            "severity": 2,
            "status": 3,
            "messsage": sampleAlarm
        },
        "control": {
            "lowLimit": 10,
            "highLimit": 100
        },
        "display": {
            "lowDisplay": 10,
            "highDisplay": 100,
            "messsage": sampleDisplay,
            "units": "meters"
        },
        "time": {
            "unixSec": 1354719441,
            "nanoSec": 521786982,
            "userTag": 1
        }
    }
                    </pre>             
                    <hr />            
                </div>

                <!-- Table -->
                <h3>Table</h3>                
                <div id="seds_table">
                    <p>A Table:</p>
                    <pre>
    <span class="seds">Table</span> :=
                Integer          numRows
                Integer          numColumns
                String[]    	 names
                String[]    	 columnTypes
                ScalarArray[] 	 values
                    </pre>

                    <p>Descriptions:</p>                    
                    <pre>
    Table:
        A table. Tables are collections of columns, each of which is composed of 
        a column name, unit, type, and data array. All elements of the same 
        column SHOULD be of the same type.

        Unit information is contained within the ScalarArray columns Display 
        field.
                    </pre>
                    <pre>
    numRows:
        The number of rows.

    numColumns:
        The number of columns.

    names:
        The name of each column.

    columnTypes:
        The types (represented as strings) of each column.

    values:
        The column data, where each column is a SedsScalarArray.
                    </pre>                            

                    <!-- Schema -->
                    <p>The JSON Schema of a Table is as follows:
                        <a href="schema/prototype/SedsTable.json">Table Schema</a></p>

                    <p>An example of a JSON instance of a Table:</p>
                    <pre>                
    {
        "names": [
            "NumberColumn",
            "IntegerColumn",
            "StringColumn"
        ],
        "units": [
            "meters",
            "seconds",
            "properties"
        ],
        "columnTypes": [
            "SedsScalarArray_String",
            "SedsScalarArray_Number",
            "SedsScalarArray_String"
        ],
        "values": [
            {
                "valueArray":[
                    "A",
                    "B",
                    "C"
                ]
            },
            {
                "valueArray":[
                    3.1,
                    3.2,
                    3.3
                ]
            },
            {
                "valueArray":[
                    "NONE",
                    "MINOR",
                    "NONE"
                ]
            }
        ]
    }
                    </pre>              
                    <hr />                     
                </div>

            </div>

            <!-- Summary -->
            <div id="summary">
                <h2>Summary</h2>

                <h3>Schema</h3>
                <div>
                    <p>Provided below are the JSON Schemas that SHOULD actually
                        be used to validate SEDS data.</p>
                    <p>Note that the previous
                        schemas may have referenced other SEDS schemas but
                        did not actually define the referenced schemas. The
                        schemas in this section define all references and
                        provide the protocol for serializing:</p>
                    <ul>
                        <li>
                            SEDS (Metadata and Raw data combined):
                            <a href="schema/SEDS_type.json">SEDS Schema</a>
                        </li>
                        <li>
                            SEDS Metadata:
                            <a href="schema/SEDS_meta.json">SEDS_meta Schema</a>                          
                        </li>
                        <li>
                            SEDS Raw data:
                            <a href="schema/SEDS_raw.json">SEDS_raw Schema</a>                                
                        </li>
                    </ul>

                    <!-- Schema List-->
                    <div>
                        <p>The full list of all SEDS schemas:</p>
                        <ul>
                            <li><a href="schema/SEDS_type.json">SEDS Schema</a></li>
                            <li><a href="schema/SEDS_meta.json">SEDS_meta Schema</a></li>
                            <li><a href="schema/SEDS_raw.json">SEDS_raw Schema</a></li>     
                        </ul>
                        <ul>
                            <li><a href="schema/prototype/SedsMetadata.json">Metadata Schema</a></li>
                            <li><a href="schema/prototype/SedsAlarm.json">Alarm Schema</a></li>
                            <li><a href="schema/prototype/SedsControl.json">Control Schema</a></li>                            
                            <li><a href="schema/prototype/SedsDisplay.json">Display Schema</a></li>
                            <li><a href="schema/prototype/SedsEnum.json">Enum Schema</a></li>
                            <li><a href="schema/prototype/SedsTime.json">Time Schema</a></li>
                            <li><a href="schema/prototype/SedsScalar.json">Scalar Schema</a></li>
                            <li><a href="schema/prototype/SedsScalarArray.json">ScalarArray Schema</a></li>
                            <li><a href="schema/prototype/SedsTable.json">Table Schema</a></li>
                        </ul>
                    </div> 

                    <hr />
                </div>

                <h3>UML Diagrams</h3>                
                <div>

                    <p>Provided below is UML class diagram to show an overview
                        of the SEDS Types. For each SEDS Type, the diagrams 
                        summarize each field, the type of each field, 
                        and the optionality of each field.</p>

                    <pre>
UML Diagram:

<img src='uml/datatypes.png' alt='UML Diagram' />
                    </pre>

                    <pre>
Detailed UML Diagram:

<img src='uml/datatypes-detail.png' alt='UML Diagram (Details)' />
                    </pre>

                </div>
            </div>            

            <!-- References -->
            <div id="references">

                <!-- In-text References -->
                <h2>References</h2>
                <dl>
                    <dd>[1] <a href="http://www.aps.anl.gov/epics/">EPICS</a></dd>
                    <dd>[2] <a href="http://www.json.org/">JSON Format</a></dd>
                    <dd>[3] <a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">ECMA-404 The Json Data Interchange Format</a></dd>								
                    <dd>[4] <a href="http://json-schema.org/">JSON Schemas</a></dd>
                </dl>

                <!-- Related References -->
                <div>
                    <p>Useful Links:</p>
                    <dl>
                        <dd>[1] <a href='http://epics-pvdata.sourceforge.net/alpha/normativeTypes/normativeTypes.html'>Normative Types</a></dd>
                        <dd>[2] <a href='http://docs.oracle.com/javaee/7/tutorial/doc/jsonp008.htm'>Java EE - Json Tutorial</a></dd>
                        <dd>[3] <a href='http://docs.oracle.com/javaee/7/api/javax/json/package-summary.html'>Java EE - Json Java Documentation</a></dd>
                        <dd>[4] <a href='http://json-schema-validator.herokuapp.com/'>JSON Schema Validator</a></dd>
                    </dl>
                </div>
            </div>

        </div>

    </body>

</html>